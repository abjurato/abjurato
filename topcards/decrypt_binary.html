<!DOCTYPE html><html><head><link rel="stylesheet" href="https://abjurato.github.io/general.css" type="text/css"/><title>decrypt iOS app (from jailbroken device memory)</title><meta name="twitter:title" content="decrypt iOS app (from jailbroken device memory)"/><meta name="og:title" content="decrypt iOS app (from jailbroken device memory)"/><meta name="twitter:image" content="https://abjurato.github.io/images/2.jpeg"/><meta name="og:image" content="https://abjurato.github.io/images/2.jpeg"/><meta name="twitter:card" content="summary"/><meta name="description" content="decrypt iOS app (from jailbroken device memory)"/><meta name="twitter:description" content="decrypt iOS app (from jailbroken device memory)"/><meta name="og:description" content="decrypt iOS app (from jailbroken device memory)"/><link rel="canonical" href="https://abjurato.github.io/decrypt_binary.html"/><meta name="twitter:url" content="https://abjurato.github.io/decrypt_binary.html"/><meta name="og:url" content="https://abjurato.github.io/decrypt_binary.html"/></head><body><h1>Decrypt iOS app (from jailbroken device memory)</h1><h2>Manually</h2><p>In this part we'll be moving straightforward: when app is launched, binary is decrypted and loaded memory. We will read the according blob from memory, write to a file, transfer that file to mac, replace encrypted section of Mach-O file with this blob and edit load commands so <span class="filepath">launchd</span> will not consider this binary encrypted. That will not allow running the binary from sandboxed directories, you will need to re-sign the binary with your own sign identity or sideload the app to the device in some other way. Decrypted binary may be inspected in disassembler or other tools.</p><p><h3>Prepare encrypted binary</h3>You will need <span class="filepath">otool</span> and <span class="filepath">scp</span> utilities on macOS side<ul><li>[iOS side] run the app and detect path to the executable:<span class="snippet"># ps ax | grep NAME</span></li><li>[macOS side] pull the file from iOS device to your mac:<span class="snippet">$ scp root@&lt;IP&gt;:&lt;IOS-PATH&gt; &lt;MAC-PATH&gt;</span></li><li>[macOS side] find details of encrypted section in load commands:<span class="snippet">$ otool -l &lt;MAC-PATH&gt; | grep crypt</span>that will give output similar to this one:<script src="https://gist.github.com/abjurato/d02aa3d04cef70c78e408ab76030e90a.js"></script></li></ul></p><p><h3>Attach debugger to iOS app</h3>You will need <span class="filepath">debugserver</span> on iOS side, <span class="filepath">lldb</span> and <span class="filepath">MachOView</span> on macOS side<ul><li>[iOS side] run the app tell debugserver to attech to it and wait for debugger on some port<span class="snippet"># debugserver *:&lt;PORT&gt; -a &lt;NAME&gt;</span></li><li>[macOS side] Run lldb, connect to port exposed by debugserver from iOS:<script src="https://gist.github.com/abjurato/21f676fa5c7ba85d5bccf824e5f806b1.js"></script></li><li>[macOS side] Inject dump into encrypted binary you've obtained earlier<span class="snippet">$ dd seek=&lt;cryptoff&gt; bs=1 conv=notrunc if=&lt;DUMP&gt; of=&lt;BINARY&gt;</span></li><li>Disable load command managing decryption of encrypted section in the patchedÂ binary:<ul><li>open binary in MachOView</li><li><span class="filepath">Load Commands</span> &gt; <span class="filepath">LC_ENCRYPTION_INFO_64</span></li><li>for CryptID line set Data to 0</li></ul></li></ul></p><h2>Frida</h2><p>There were many automated alternatives for this task: Clutch, bfinject, etc. As of iOS 12 this task can be most comfortably automated using Frida (once you'll figure out how to properly configure it). You will need <span class="filepath">iTunnel</span> and <span class="filepath">Frida</span> and Frida plugin called <span class="filepath">frida-ios-dump</span>.<ul><li>[macOS side] run iTunnel to forward SSH traffic to USB<span class="snippet">$ itnl --lport 2222 --iport 22</span></li><li>[macOS side] run properly configured script from plugin directory to find identifier of app you need:<span class="snippet">$ ./dump.py -l</span></li><li>[macOS side] run properly configured script from plugin directory to dump the app, full ipa bundle will be created on your mac:<span class="snippet">$ ./dump.py &lt;IDENTIFIER&gt;</span></li></ul></p><br/><h2>Sources</h2><p><a href="https://github.com/ivRodriguezCA/RE-iOS-Apps/blob/master/Module-2/README.md">[1] Reverse Engineering iOS Applications by Ivan Rodriguez</a></p></body></html>