<!DOCTYPE html><html><head><link rel="stylesheet" href="https://abjurato.github.io/general.css" type="text/css"/><title>Back-port .fullScreenCover to SwiftUI 1.0</title><meta name="twitter:title" content="Back-port .fullScreenCover to SwiftUI 1.0"/><meta name="og:title" content="Back-port .fullScreenCover to SwiftUI 1.0"/><meta name="twitter:image" content="https://abjurato.github.io/images/0.jpeg"/><meta name="og:image" content="https://abjurato.github.io/images/0.jpeg"/><meta name="twitter:card" content="summary"/><meta name="description" content="Back-port .fullScreenCover to SwiftUI 1.0"/><meta name="twitter:description" content="Back-port .fullScreenCover to SwiftUI 1.0"/><meta name="og:description" content="Back-port .fullScreenCover to SwiftUI 1.0"/><link rel="canonical" href="https://abjurato.github.io/stories/fullScreenCover.html"/><meta name="twitter:url" content="https://abjurato.github.io/stories/fullScreenCover.html"/><meta name="og:url" content="https://abjurato.github.io/stories/fullScreenCover.html"/></head><body class="comment"><a href="https://abjurato.github.io/">(lldb) thread step-out</a><h1>Back-port .fullScreenCover to SwiftUI 1.0</h1><h2>Modal presentation in SwiftUI</h2><p>SwiftUI 2.0 presented on WWDC20 brings us a lot of small improvements and additions to the APIs. In iOS 13 we already had API to open views modally in a bottom-rising sheet, but whatever the contents presentation mode was, there was no way to present it full screen.Real-life example: early versions of our app had to present Camera of <span class="inlinecode">UIImagePickerController</span> in such sheet which looked very stupid.</p><p>One of the new APIs adds an ability to open views modally - <span class="inlinecode">fullScreenCover(isPresented:onDismiss:content:)</span>.Unfortunately, this view modifier is available only on iOS 14 and higher.<div class="screenshot"><img src="https://abjurato.github.io/images/fullScreenCover_01.png"/></div></p><p><h2>How can it be back ported to iOS 13?</h2>Short answer: with help of UIKit and thanks to its interoperability with SwiftUI.<ol><li>As one can remember, UIKit is managing view hierarchy by means of <span class="inlinecode">UIViewControllers</span> which can serve as presenters to each other. In a simple cases presentation transition (animation and which part of the screen the presented controller's view will take) depends on presenting controller's <span class="inlinecode">.presentationStyle</span>;</li><li>SwiftUI can wrap <span class="inlinecode">UIViewControllers</span> into <span class="inlinecode">UIViewControllerRepresentable</span> views and embed into hierarchy like any other View. Such controllers have 2 important methods (<span class="inlinecode">makeUIViewController</span>, <span class="inlinecode">dismantleUIViewController</span>) which will help us manage presentation process</li></ol>So, generally the plan is:<ol><li>Add invisible <span class="inlinecode">UIViewController</span> to parent SwiftUI view</li><li>Provide this controller with a child SwitUI view that needs to be presented in a full screen modal</li><li>When this controller appears in the hierarchy, it will present the child using UIKit APIs</li><li>When the child should be dismissed, the controller should be removed from the hierarchy</li></ol><div class="screenshot"><img src="https://abjurato.github.io/images/fullScreenCover_02.png"/></div></p><p>Empowered by the beauty of <span class="inlinecode">ViewModifiers</span> we can keep code almost the same!<div class="screenshot"><img src="https://abjurato.github.io/images/fullScreenCover_03.png"/></div>Production code will be more complex, but for the sake of simplicity let's omit edge cases:<ul><li>First, we'll create ModalContainerModifier which will make our API indistinguishable from native SwiftUI's one. It will embed invisible ModalContainer (UIViewControllerRepresentable) to a background when modal should be presented;</li><li>In makeUIViewController we'll be wrapping SwiftUI contents-to-be-presented into UIHostingController and define presentationStyle of this child view controller - in this case .overFullScreen - which later UIKit will use for presentation. The invisible proxy will be a blank UIViewController, it's purpose is to call present(_:animated:completion) once it appears;</li><li>Another important point is dismantleUIViewController - it will be called once SwiftUI removes our ModalContainer from the hierarchy. That is a correct moment to dismiss child viewController, otherwise it will never ever be removed.</li></ul></p><p><h2>Code</h2><div class="gist"><script src="https://gist.github.com/abjurato/386c32affe61eabab1ff4f5bd715ae89.js"></script></div></p><br/><h2>Following steps</h2><p><a href="https://swiftui-lab.com/backward-compatibility/">[1] More about approaches to backwards compatibility in SwiftUI</a></p><p><a href="https://coderwall.com/p/dgdgeq/how-to-re-sign-ios-builds">[2] How to re-sign iOS builds</a></p><br/><div class="comment">27/09/2020</div></body></html>